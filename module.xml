<?xml version="1.0" ?>
<!--@POSTPROC: ./postproc.sh-->
<module suppressWarnings="true">

<User f="nodata">
  <User>
    <Select_User t="dropdown" f="user"/>
    <Login t="button" l="Control"/>
  </User>
</User>

<Control f="nodata">
  <Main>
    <Take_Feature t="button" l="Burial_Mound"/>
    <autonum/>
    <GPS_Diagnostics t="gpsdiag"/>
  </Main>
  <Table>
    <Table>
      <!--This is replaced with a table view using @POSTPROC-->
    </Table>
  </Table>
  <search>
    Records
  </search>
  <Map>
    <Map t="map"/>
  </Map>
</Control>

<Burial_Mound>
  <General>
    <Object_ID f="id notnull autonum"/>
    <timestamp/>
    <author/>
    <Type>
      <opts>
        <opt>Burial mound</opt>
        <opt>Surface concentration</opt>
        <opt>Special find</opt>
        <opt>Standing masonry</opt>
        <opt>Earthwork</opt>
        <opt>Unknown</opt>
        <opt>Other</opt>
      </opts>
    </Type>
    <Site_Significance>
      <desc>Assess the site's potential for our research objectives or for excavation. Add details in Recommendation at the end of this module.</desc>
      <opts>
        <opt>None</opt>
        <opt>Low</opt>
        <opt>Medium</opt>
        <opt>High</opt>
      </opts>
    </Site_Significance>
    <Name/>
    <Description/>
    <Source>
      <opts>
        <opt>Survey</opt>
        <opt>Remote sensing</opt>
        <opt>Informant</opt>
        <opt>Legacy verification</opt>
        <opt>Bibliography</opt>
        <opt>Other</opt>
      </opts>
    </Source>
    <Exists_in_Legacy t="checkbox">
      <opts>
        <opt>Topo</opt>
        <opt>Satellite Image</opt>
        <opt>Other</opt>
      </opts>
    </Exists_in_Legacy>
    <Surrounding_Landuse>
      <opts>
        <opt>Annual agriculture
          <opt>Ploughed</opt>
          <opt>Harrowed</opt>
          <opt>Seedlings</opt>
          <opt>Mature crop</opt>
          <opt>Harvested</opt>
        </opt>
        <opt>Perennial
          <opt>Orchard</opt>
          <opt>Lavender</opt>
          <opt>Vineyard</opt>
        </opt>
        <opt>Other
          <opt>Meadow</opt>
          <opt>Beach</opt>
          <opt>Scrub</opt>
          <opt>Forest</opt>
          <opt>Other</opt>
        </opt>
      </opts>
    </Surrounding_Landuse>
    <Surface_Landuse>
      <opts>
        <opt>Annual agriculture
          <opt>Ploughed</opt>
          <opt>Harrowed</opt>
          <opt>Seedlings</opt>
          <opt>Mature crop</opt>
          <opt>Harvested</opt>
        </opt>
        <opt>Perennial
          <opt>Orchard</opt>
          <opt>Lavender</opt>
          <opt>Vineyard</opt>
        </opt>
        <opt>Other
          <opt>Meadow</opt>
          <opt>Beach</opt>
          <opt>Scrub</opt>
          <opt>Forest</opt>
          <opt>Other</opt>
        </opt>
      </opts>
    </Surface_Landuse>
    <Visibility>
      <opts>
        <opt>0-20%</opt>
        <opt>20-40%</opt>
        <opt>40-60%</opt>
        <opt>60-80%</opt>
        <opt>80-100%</opt>
      </opts>
    </Visibility>
    <gps/>
    <Elevation b="decimal">
      Elevation (MASL)
    </Elevation>
    <General_Notes/>
    <Create_Shapefile t="button" l="Control/Map"/>
    <General_Photo t="camera">
      <desc>Take 1 general overview shot that includes the complete feature profile, and a scale. Include direction in the Annotation (from which direction was the image taken)</desc>
    </General_Photo>
  </General>
  <Dimensions>
    <Profile t="picture"/>
    <Plan t="picture">
      <opts>
        <opt>Circular</opt>
        <opt>Elipsoid</opt>
        <opt>Uneven</opt>
      </opts>
    </Plan>
    <cols>
      <col>
        <Length_Max/>
        <Width_Max/>
        <Height_Max/>
        <Area_Max/>
      </col>
      <col>
        <Length_Min/>
        <Width_Min/>
        <Height_Min/>
        <Area_Min/>
      </col>
    </cols>
    <Other_Dimension/>
    <Dimensions_Notes/>
    <Attach_A_Sketch t="file"/>
    <Sketch_Photo t="camera"/>
  </Dimensions>
  <Material>
    <Stone_Feature_Present_And_Visible t="radio">
      Stone Feature Present And Visible?
      <opts>
        <opt>Yes</opt>
        <opt>No</opt>
      </opts>
    </Stone_Feature_Present_And_Visible>
    <Stone_Feature_Description/>
    <Surface_Material_Density>
      <opts>
        <opt>zero</opt>
        <opt>scarce</opt>
        <opt>medium</opt>
        <opt>high</opt>
      </opts>
    </Surface_Material_Density>
    <Surface_Material_Description/>
    <Sample_Collected t="radio">
      Sample Collected?
      <opts>
        <opt>Yes</opt>
        <opt>No</opt>
      </opts>
    </Sample_Collected>
    <Material_Photo t="camera"/>
  </Material>
  <CRM>
    <Disturbance_Kind>
      <opts>
        <opt>undisturbed</opt>
        <opt>surface sediment disturbed</opt>
        <opt>subsurface disturbed</opt>
        <opt>totally disturbed</opt>
        <opt>unknown</opt>
      </opts>
    </Disturbance_Kind>
    <Disturbance_Factors t="checkbox">
      <opts>
        <opt>anthropic</opt>
        <opt>animal activity</opt>
        <opt>post depositional</opt>
        <opt>topographic</opt>
      </opts>
    </Disturbance_Factors>
    <Principal_Factors>
      <desc>Select one factor that contributes to most visible damage</desc>
      <opts>
        <opt>Anthropic
          <opt>Agricultural</opt>
          <opt>Looting</opt>
          <opt>Development</opt>
        </opt>
        <opt>Post-depositional
          <opt>Mound geomorphology</opt>
          <opt>Erosion</opt>
          <opt>Wind damage</opt>
          <opt>Water damage</opt>
          <opt>Age</opt>
        </opt>
        <opt>Topographic
          <opt>Aspect</opt>
          <opt>Slope</opt>
          <opt>Exposure</opt>
          <opt>Hydrology</opt>
        </opt>
      </opts>
    </Principal_Factors>
    <Age_of_Damage t="checkbox">
      <opts>
        <opt>Remote</opt>
        <opt>Recent</opt>
        <opt>Fresh</opt>
      </opts>
    </Age_of_Damage>
    <Disturbance_Description/>
    <RT_Kind t="checkbox">
      <opts>
        <opt>Basic pit</opt>
        <opt>Trench</opt>
        <opt>Tunnel</opt>
      </opts>
    </RT_Kind>
    <RT_Method t="checkbox">
      <opts>
        <opt>Manual</opt>
        <opt>Mechanized</opt>
      </opts>
    </RT_Method>
    <RT_Frequency t="picture"/>
    <RT_Description/>
    <Volume_of_Soil_Removed_via_RT>
      <opts>
        <opt>&lt;10%</opt>
        <opt>10-20%</opt>
        <opt>20-30%</opt>
        <opt>30-40%</opt>
        <opt>40-40%</opt>
        <opt>50-40%</opt>
        <opt>60-40%</opt>
        <opt>70-40%</opt>
        <opt>80-40%</opt>
        <opt>90-100%</opt>
      </opts>
    </Volume_of_Soil_Removed_via_RT>
    <Affect>
      <desc>1=0-20% of the entire feature is missing or disrupted, 5= 80-100% of the feature's surface is missing or disrupted</desc>
      <opts>
        <opt>1</opt>
        <opt>2</opt>
        <opt>3</opt>
        <opt>4</opt>
        <opt>5</opt>
      </opts>
    </Affect>
    <Impact>
      <desc>1= context is nearly intact; 5 = original context of the feature is nearly all destroyed</desc>
      <opts>
        <opt>1</opt>
        <opt>2</opt>
        <opt>3</opt>
        <opt>4</opt>
        <opt>5</opt>
      </opts>
    </Impact>
    <Comments_and_Recommendations/>
    <CRM_Photo t="camera"/>
  </CRM>
</Burial_Mound>

<logic><![CDATA[
/********************************* TABLE VIEW *********************************/
  q   = "select uuid, attributename, response\n" + 
        "from (select attributename, attributeid\n" + 
        "from attributekey join idealaent using (attributeid) join aenttype using (aenttypeid)\n" + 
        "where aenttypename = 'small'), (select uuid, aenttypeid, aenttypename, aenttimestamp, group_concat(coalesce(measure, freetext, vocabname, '<null>'), '|') || coalesce(case certainty <1 when 1 then '?' end, '') as isIdent\n" + 
        "from latestnondeletedarchentidentifiers \n" + 
        "where aenttypename = 'small'\n" + 
        "group by uuid\n" + 
        "order by attributename\n" + 
        ") as id \n" + 
        "left outer join \n" + 
        "(select uuid, valuetimestamp, attributename, attributeid, group_concat(coalesce(measure    || ' '  || vocabname  || '(' ||freetext||') '||  coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              measure    || ' (' || freetext   ||')'||  coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              vocabname  || ' (' || freetext   ||')'||  coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              measure    || ' ' || vocabname   ||  coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              vocabname  || ' (' || freetext || ')',\n" + 
        "                                                                                              measure    || ' (' || freetext || ')',\n" + 
        "                                                                                              measure    || coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              vocabname  || coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              freetext   || coalesce(case certainty <1 when 1 then '?' end, '') ,\n" + 
        "                                                                                              measure,\n" + 
        "                                                                                              vocabname,\n" + 
        "                                                                                              freetext), ' | ') as response\n" + 
        "FROM (  SELECT uuid, attributeid, vocabid, attributename, vocabname, measure, freetext, certainty, attributetype, valuetimestamp, aenttimestamp          \n" + 
        "          FROM latestnondeletedaentvalue join latestnondeletedarchent using (uuid)\n" + 
        "          JOIN attributekey using (attributeid)          \n" + 
        "          LEFT OUTER JOIN vocabulary USING (vocabid, attributeid)          \n" + 
        "       ORDER BY uuid, attributename ASC)\n" + 
        "group by uuid, attributeid) using (uuid, attributeid, attributename)\n" + 
        "union \n" + 
        "select uuid, 'geometry', astext(geospatialcolumn)\n" + 
        "from (select uuid, aenttypeid, aenttypename, aenttimestamp, group_concat(coalesce(measure, freetext, vocabname, '<null>'), '|') || coalesce(case certainty <1 when 1 then '?' end, '') as isIdent, geospatialcolumn\n" + 
        "from latestnondeletedarchentidentifiers \n" + 
        "where aenttypename = 'small'\n" + 
        "group by uuid\n" + 
        "order by attributename\n" + 
        ") as id \n" + 
        "union \n" + 
        "select uuid, 'username', fname || ' ' || lname\n" + 
        "from (select uuid, aenttypeid, aenttypename, aenttimestamp, group_concat(coalesce(measure, freetext, vocabname, '<null>'), '|') || coalesce(case certainty <1 when 1 then '?' end, '') as isIdent, fname, lname\n" + 
        "from latestnondeletedarchentidentifiers join user using (userid)\n" + 
        "where aenttypename = 'small'\n" + 
        "group by uuid\n" + 
        "order by attributename\n" + 
        ") as id \n" + 
        "union \n" + 
        "select uuid, 'action', uuid \n" + 
        "from latestnondeletedarchent join aenttype using (aenttypeid) \n" + 
        "where aenttypename = 'small' \n" + 
        "group by uuid \n" + 
        "order by uuid, attributename;";

  tableRef       = "Control/Table/Table";
  // query          = "SELECT uuid, response ";
  // query         += "FROM latestNonDeletedArchEntFormattedIdentifiers ";
  headers        = new ArrayList();
  actionName     = "Load";
  actionIdx      = 0;
  actionCallback = "loadEntityFromTable()";

  headers.add("Object ID");
  headers.add("Type");
  headers.add("Site Significance");
  headers.add("Name");
  headers.add("Description");
  headers.add("Source");
  headers.add("Exists in Legacy");
  headers.add("Surrounding Landuse");
  headers.add("Surface Landuse");
  headers.add("Visibility");
  headers.add("Elevation");
  headers.add("General Notes");
  headers.add("General Photo");
  headers.add("Profile");
  headers.add("Plan");
  headers.add("Length Max");
  headers.add("Width Max");
  headers.add("Height Max");
  headers.add("Area Max");
  headers.add("Length Min");
  headers.add("Width Min");
  headers.add("Height Min");
  headers.add("Area Min");
  headers.add("Other Dimension");
  headers.add("Dimensions Notes");
  headers.add("Attach A Sketch");
  headers.add("Sketch Photo");
  headers.add("Stone Feature Present And Visible");
  headers.add("Stone Feature Description");
  headers.add("Surface Material Density");
  headers.add("Surface Material Description");
  headers.add("Sample Collected");
  headers.add("Material Photo");
  headers.add("Disturbance Kind");
  headers.add("Disturbance Factors");
  headers.add("Principal Factors");
  headers.add("Age of Damage");
  headers.add("Disturbance Description");
  headers.add("RT Kind");
  headers.add("RT Method");
  headers.add("RT Frequency");
  headers.add("RT Description");
  headers.add("Volume of Soil Removed via RT");
  headers.add("Affect");
  headers.add("Impact");
  headers.add("Comments and Recommendations");
  headers.add("CRM Photo");
  headers.add("Latitude");
  headers.add("Longitude");
  headers.add("Northing");
  headers.add("Easting");

  populateTable() {
    populateTableRaw(tableRef, q    , headers, actionName, actionIdx, actionCallback);
  }

  loadEntityFromTable() {
    uuid = getTableValue();
    loadEntityFrom(uuid); // Auto-gen'd function
  }

  addOnEvent(tableRef, "show", "populateTable()");


]]></logic>

</module>
